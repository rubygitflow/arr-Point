.map
  #map
  javascript: 
    DG.then(function() {
      var map,
          marker;

      map = DG.map('map', {
          center: [55.7508, 37.6177],
          zoom: 10
      });
      DG.marker([55.8558, 37.7227]).addTo(map).bindPopup('msk 2132'); // объявление контрольного маркера - всегда видим его

      marker = DG.marker([55.7558, 37.6177]).addTo(map).bindPopup('uyy7765'); // объявление маркера

      var increment1 = -0.005, 
          increment2 = 0.005; // объявление КОНСТАНТ для смещения координаты по-умолчанию в новую позицию 

      console.log('increment1',typeof(increment1)); // отображаем тип статического смещения 
      console.log('increment2',typeof(increment2)); // отображаем тип статического смещения

      function move() {
        if (!map.getBounds().contains(marker.getLatLng())) {
            increment1 *= -1;
            increment2 *= -1;
        }  // сюда не попадём, просто оставлен код из демки


        if (gon.drivers) { // удостоверяемся, что данные подгружены извне


          gon.drivers.forEach(function(driver) {  
            var car = driver.cars.filter(function(car){
              return car.workhorse == true;
            }); // извлекаем объект с координатами для отображения
            if (car[0].coordinates) { // извлекаем объект с координатами для отображени

              // всё началось с того, что строчка ниже ничего не отображает
              // DG.marker(car[0].coordinates).addTo(map).bindPopup(car[0].license_plate); // - никогда не видим его

              console.log('car[0].coordinates',car[0].coordinates);  // удостоверяемся в получении данных
              console.log('car[0].coordinates[0]',car[0].coordinates[0]); // 
              console.log('car[0].coordinates[1]',car[0].coordinates[1]); // отображаем тип динамического смещения
 

              var increment3 = car[0].coordinates[0] - marker.getLatLng().lat,
                  increment4 = car[0].coordinates[1] - marker.getLatLng().lng; // объявление ПЕРЕМЕННЫХ для смещения координаты по-умолчанию в новую позицию 

              console.log('increment3',typeof(increment3)); 
              console.log('increment4',typeof(increment4));  // отображаем тип вычисленных смещений


              // отображаем так и ВИДИМ МЕТКУ
              // var newLat = marker.getLatLng().lat + increment1, 
              //     newLng = marker.getLatLng().lng + increment2;  // новые координаты со смещением из констант

              // ИЛИ отображаем так и НЕ ВИДИМ МЕТКУ
              var newLat = marker.getLatLng().lat + increment3,
                  newLng = marker.getLatLng().lng + increment4; // новые координаты с вычисленным смещением из  координат в базе данных


              // убеждаемся, что новые значения реальные
              console.log('newLat',newLat); 
              console.log('newLng',newLng);

              // собственно переназначение координат МЕТКИ
              marker.setLatLng([newLat, newLng]);

            }
          });

        }

        clearInterval(intervalID); // останавливаем таймер
      }

      var intervalID = setInterval(move, 60); // запускаем таймер
    });


  .title = link_to "«#{ t('service_name') }»", root_url, id:'service_name' 
  div class="menu-map" title="#{ t('.menu') }" 
    .dropbtn onclick="dropFunction()"
      i class="fas fa-bars fa-3x"
    .dropup-content#menuDropup
      = link_to 'RU / EN', change_language_maps_url, id:'langbtn', 
        data: { onclick:'changeLangFunction()'}
      - if user_signed_in?
        = link_to "#{ t('sign_out') }", destroy_user_session_url, method: :delete
        - if params[:car].present?
          = link_to "#{ t('edit_ride') }", menu_car_rides_url(car_id: params[:car])
        - else
          = link_to t("go_to_profile").html_safe, drivers_splitter_path

      - else
        = link_to "#{ t('sign_up') }", new_user_registration_url
        = link_to "#{ t('sign_in') }", new_user_session_url

    javascript: 
      function dropFunction() {
        var elem = document.getElementById("menuDropup");
        if (elem.style.display=="block") {
          elem.style.display = "none";
        } else {
          elem.style.display = "block";
        }        
      }
